---
phase: spec-016-code-expressiveness
task: Phase 8f complete (T078+T079), Phase 8b-e next
total_tasks: 86
completed_tasks: 72
status: between_phases
last_updated: 2026-02-24T18:15:00.000Z
---

<current_state>
Phase 8f (Client-Side Fetch Wrapper) is complete — T078 (fetchJSON utility) and T079 (migration) done.
fetchJSON<T>() created in src/lib/utils/fetch-json.ts with 5 passing tests.
Migrated 10 fetch call sites across 8 files to use fetchJSON:

- status-bar-data.ts: fetchHardwareStatus(), fetchHardwareDetails()
- OverviewPanel.svelte: fetchSystem(), fetchHardware(), fetchHardwareDetails()
- TerminalPanel.svelte: shells fetch
- map-helpers.ts: fetchTowerData()
- agent-chat-logic.svelte.ts: initializeChat()
- GsmEvilPanel.svelte: fetchTowerLocation(), fetchIMSIs(), onMount status check
- gsm-evil-page-logic.ts: fetchTowerLocation(), fetchIMSIs()
- tak-config-logic.ts: loadConfig()
- tak-service.ts: checkTakStatus()

Complex fetch patterns (Zod validation, streaming, store orchestration, FormData uploads) correctly left as-is.
Build passes. Zero TypeScript errors. Branch: 016-code-expressiveness.
</current_state>

<completed_work>
This session completed T078+T079 (2 tasks):

- T078: Created fetchJSON<T>() wrapper with 5 unit tests
- T079: Migrated 10 simple fetch patterns across 8 files

Overall progress: 72/86 tasks done (Phases 1-7, 9-16, 18, 8a+8f complete)
</completed_work>

<remaining_work>
Phase 8b-e — Client Libraries (7 tasks, requires npm install approval):

- T018-T019: data-table (@tanstack/table-core)
- T020-T021: virtual scrolling (virtua)
- T022: form validation (sveltekit-superforms + formsnap)
- T023: svelte-query (@tanstack/svelte-query) — optional
- T024: Unify dual Kismet store architecture

Phase 17 — Final Verification (7 tasks):

- T061-T067: Full test suite, build, LOC delta, SC verification, bundle size

Total remaining: 14 tasks across 2 phases
</remaining_work>

<decisions_made>

- fetchJSON only targets simple "fetch → json → return or null" patterns
- Complex patterns (Zod validation, store mutations, streaming) intentionally excluded
- Removed unused logger imports from GsmEvilPanel.svelte, tak-config-logic.ts, tak-service.ts
- Used precise generic types (e.g. Record<string, Record<string, unknown>> for hardware status)
- Agent chat provider narrowed via equality check instead of cast (type safety)
  </decisions_made>

<blockers>
Phase 8b-e requires user approval for npm install of 3-4 packages.
Phase 17 depends on all other phases (can run without 8b-e if deferred).
</blockers>

<next_action>
Ask user whether to proceed with Phase 8b-e (client libraries, needs npm install approval) or skip to Phase 17 (final verification).
Commit the T078+T079 work first.
</next_action>
</content>
</invoke>
