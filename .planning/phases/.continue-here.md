---
phase: spec-016-code-expressiveness
task: Phase 15 complete, Phase 16 next
total_tasks: 86
completed_tasks: 55
status: between_phases
last_updated: 2026-02-24T14:48:18.778Z
---

<current_state>
Phase 15 (US12 Oversized File Decomposition) is fully complete — all 13/13 tasks done, verified, committed, and pushed.
Next up is Phase 16 (Type Safety — T058, T059, T060, T085, T086).
Working tree is clean (only untracked planning/doc files). Branch: 016-code-expressiveness. Remote is up to date.
</current_state>

<completed_work>
This session completed Phase 15 Batch 3 (5 tasks):

- T053: `gsm-scan-capture.ts` (313→169) — extracted gsm-scan-events.ts (cell-identity event formatting)
- T054: `sweep-manager.ts` (313→300) — extracted sweep-manager-lifecycle.ts (startup validation, event emission)
- T055: `tak-service.ts` (312→298) — extracted tak-broadcast.ts (WebSocket broadcast helpers)
- T056: `kismet-control-service-extended.ts` (308→241) — extracted kismet-status-checker.ts (process detection, WiFi adapter discovery, API health)
- T057: `DashboardMap.svelte` (300) — evaluated borderline; at exactly 300 LOC with purely declarative MapLibre markup, no clean split exists. No changes needed.

New modules created:

- src/lib/server/services/gsm-evil/gsm-scan-events.ts (138 LOC)
- src/lib/server/hackrf/sweep-manager-lifecycle.ts (96 LOC)
- src/lib/server/tak/tak-broadcast.ts (42 LOC)
- src/lib/server/services/kismet/kismet-status-checker.ts (88 LOC)

Commit: c25595c refactor(decompose): T053+T054+T055+T056+T057 — Phase 15 Batch 3 file decomposition

Overall progress: 55/86 tasks done (Phases 1-15 complete, plus Phase 8a and 9-10)
</completed_work>

<remaining_work>
Phase 16 — Type Safety (5 tasks):

- T058: Declare globalThis types in src/app.d.ts for all \__argos_\* singleton augmentations
- T059: Add runtime validation to unguarded JSON.parse() calls at trust boundaries
- T060: Fix swallowed errors in OverviewPanel.svelte
- T085: Define typed interfaces for all external API response shapes (~100+ unsafe casts)
- T086: Audit and resolve remaining 4 eslint-disable directives

Phase 18 — Route Migration at Scale (10 tasks):

- T068-T077: Migrate ~60 routes to createHandler() factory in 10 batches

Phase 8b-f — Client Libraries (9 tasks, requires npm install approval):

- T018-T024, T078-T079: data-table, virtua, superforms, svelte-query, fetchJSON wrapper

Phase 17 — Final Verification (7 tasks):

- T061-T067: Full test suite, build, LOC delta, SC verification, bundle size

Total remaining: 31 tasks across 4 phases
</remaining_work>

<decisions_made>

- T056: Moved KismetStatusResult type to kismet-status-checker.ts (lower-level module) and re-exported from control module to avoid circular dependency
- T057: Decided NOT to extract from DashboardMap.svelte — at exactly 300 LOC (within limit), purely declarative MapLibre markup, forced split would fragment layer definition
- T054: Collapsed singleton section (removed KEY const, inlined string literal) to save 2 lines and hit exactly 300 LOC
- All new companion modules are self-contained — they import from external deps and types, never from their parent module (no circular deps)
  </decisions_made>

<blockers>
None. All phases are unblocked.
</blockers>

<context>
Execution strategy for remaining phases:
- Phase 16 (type safety) has a mix of small fixes (T058, T060, T086) and one large migration (T085 — ~100+ unsafe casts)
- Phase 18 (route migration) is 10 mechanical batches of ~5 routes each — highly parallelizable
- Phase 8b-f requires npm install approval for 4 new packages
- Phase 17 is final verification — depends on all other phases

Recommended execution order: 16 → 18 → 8 → 17
</context>

<next_action>
Start Phase 16 with T058 (globalThis typing — small, focused fix in app.d.ts).
Read src/app.d.ts and grep for globalThis['\_\_argos to identify all singleton augmentations.
</next_action>
