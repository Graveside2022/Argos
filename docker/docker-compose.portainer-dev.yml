# Argos Third-Party Tool Containers - Portainer Compatible
# Argos app runs natively on the host. Only third-party tools use Docker.
#
# Deploy this in Portainer as a Stack
#
# Usage:
#   docker compose -f docker/docker-compose.portainer-dev.yml --profile tools up -d openwebrx
#   docker compose -f docker/docker-compose.portainer-dev.yml --profile tools up -d bettercap

services:

  # ============================================
  # OPENWEBRX - SDR Web Interface (HackRF)
  # On-demand only: started by Argos Tools panel
  # ============================================
  openwebrx:
    image: slechev/openwebrxplus:latest
    container_name: openwebrx-hackrf
    profiles: ["tools"]
    mem_limit: 512m
    memswap_limit: 768m
    ports:
      - "8073:8073"
    environment:
      - OPENWEBRX_ADMIN_USER=admin
      - OPENWEBRX_ADMIN_PASSWORD=${OPENWEBRX_PASSWORD:?Set OPENWEBRX_PASSWORD in .env}
    devices:
      - "/dev/bus/usb:/dev/bus/usb"
    privileged: true
    volumes:
      - openwebrx-hackrf-settings:/var/lib/openwebrx
    tmpfs:
      - /tmp/openwebrx:rw,noexec,nosuid,size=100m
    networks:
      - argos-dev-network
    restart: "no"
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"

  # ============================================
  # BETTERCAP - WiFi/BLE/Network Recon
  # On-demand only: started by Argos Tools panel
  # ============================================
  bettercap:
    image: bettercap/bettercap:latest
    container_name: bettercap
    profiles: ["tools"]
    mem_limit: 256m
    memswap_limit: 384m
    network_mode: host
    devices:
      - "/dev/bus/usb:/dev/bus/usb"
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      - BETTERCAP_API_USER=${BETTERCAP_USER:-admin}
      - BETTERCAP_API_PASSWORD=${BETTERCAP_PASSWORD:?Set BETTERCAP_PASSWORD in .env}
    command: bettercap -api-rest-address 0.0.0.0 -api-rest-port 8081
    restart: "no"
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"

networks:
  argos-dev-network:
    driver: bridge
    name: argos-dev-network

volumes:
  openwebrx-hackrf-settings:
